{
    "version": 1,
    "var_self": {
        "type": "WORKFLOW",
        "id": "197b43da-4d8d-4b15-b5ee-edc7f22cac37",
        "name": "SailPoint PS - Reassign Role Ownership"
    },
    "object": {
        "id": "197b43da-4d8d-4b15-b5ee-edc7f22cac37",
        "name": "SailPoint PS - Reassign Role Ownership",
        "description": "Child workflow (external trigger) for the parent leaver workflow that changes the ownership of roles from leaver to their manager.",
        "created": "2025-04-07T23:00:14.914443989Z",
        "modified": "2025-07-25T14:49:23.782807422Z",
        "modifiedBy": {
            "type": "IDENTITY",
            "id": "8b3c97da521442999ef05af532ecf6f7",
            "name": "rahul.majumder"
        },
        "definition": {
            "start": "HTTP Request",
            "steps": {
                "Compare Numbers": {
                    "actionId": "sp:compare-numbers",
                    "choiceList": [
                        {
                            "comparator": "NumericGreaterThan",
                            "nextStep": "Send Email",
                            "variableA.$": "$.hTTPRequest.body.length()",
                            "variableB": 0
                        }
                    ],
                    "defaultStep": "End Step — Success 1",
                    "displayName": "",
                    "type": "choice"
                },
                "End Step — Success 1": {
                    "actionId": "sp:operator-success",
                    "description": "End of active path",
                    "type": "success"
                },
                "HTTP Request": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "indices": [
                                "roles"
                            ],
                            "query": {
                                "query": "owner.id:{{$.trigger.leaverId.id}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "b0f1b396f93a4ee9979d009ccd099c1f",
                        "oAuthClientSecret": "$.secrets.a30e84a0-73d3-4bc7-90cc-a3fa699419cb",
                        "oAuthCredentialLocation": "oAuthInHeader",
                        "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-uat.api.identitynow.com/v3/search?offset=0&limit=100",
                        "urlParams": null
                    },
                    "description": "get list of roles owned by this identity",
                    "displayName": "Get Roles",
                    "nextStep": "Loop",
                    "type": "action",
                    "versionNumber": 2
                },
                "Loop": {
                    "actionId": "sp:loop:iterator",
                    "attributes": {
                        "context.$": "$.trigger",
                        "input.$": "$.hTTPRequest.body",
                        "start": "HTTP Request 1",
                        "steps": {
                            "End Step — Success": {
                                "actionId": "sp:operator-success",
                                "type": "success"
                            },
                            "HTTP Request 1": {
                                "actionId": "sp:http",
                                "attributes": {
                                    "authenticationType": "OAuth",
                                    "jsonPatchRequestBody": [
                                        {
                                            "op": "replace",
                                            "path": "/owner",
                                            "value": {
                                                "id": "{{$.loop.context.managerRef.id}}",
                                                "type": "IDENTITY"
                                            }
                                        }
                                    ],
                                    "method": "patch",
                                    "oAuthClientId": "b0f1b396f93a4ee9979d009ccd099c1f",
                                    "oAuthClientSecret": "$.secrets.cc208483-1797-4562-bba9-2e5da9ebae83",
                                    "oAuthCredentialLocation": "oAuthInHeader",
                                    "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                                    "requestContentType": "json-patch+json",
                                    "requestHeaders": {
                                        "Content-Type": "application/json-patch+json"
                                    },
                                    "url": "https://igmfinancial-uat.api.identitynow.com/beta/roles/{{$.loop.loopInput.id}}"
                                },
                                "description": "look up each role and change owner",
                                "displayName": "Change Manager to Owner",
                                "nextStep": "End Step — Success",
                                "type": "action",
                                "versionNumber": 2
                            }
                        }
                    },
                    "nextStep": "Compare Numbers",
                    "type": "action",
                    "versionNumber": 1
                },
                "Send Email": {
                    "actionId": "sp:send-email",
                    "attributes": {
                        "body": "<p>Dear {{$.trigger.managerRef.name}},</p>\n<p class=\"MsoNormal\">Due to the termination/suspension of {{$.trigger.leaverId.name}}, ownership of the following Roles has been transferred to you:</p>\n<ul>#if($objsLen>1)#foreach ( $detail in ${objs} )\n<li>${detail.name}</li>\n#end #{else}\n\n<li>${objs.name}</li>\n#end\n</ul>\n<p class=\"MsoNormal\">You can access the details of these items at the following link:<br><a href=\"https://igmfinancial.service-now.com/snap?id=kb_article_view&amp;sysparm_article=KB0013953\">Corporate Employees - Access Items &ndash; Inventory with Owner and Approvers for Requests - Resource Centre</a></p>\n<p class=\"MsoNormal\">If you wish to transfer ownership to another individual, please follow the instructions provided in the link below to submit a SNAP request.</p>\n<p class=\"MsoNormal\"><a href=\"https://igmfinancial.service-now.com/snap?id=sc_cat_item&amp;sys_id=a19553aadb27981095d0ddf5f49619ed&amp;sysparm_category=a8d60a5e1b115410afb584415b4bcb53\">Authorization Request - Resource Centre</a></p>\n<p class=\"MsoNormal\">This is a system-generated email. Please do not respond to this email.</p>",
                        "context": {
                            "objs.$": "$.hTTPRequest.body",
                            "objsLen.$": "$.hTTPRequest.body.length()"
                        },
                        "recipientEmailList.$": "$.trigger.managerRef.email",
                        "replyTo.$": "",
                        "subject": "Transfer of Ownership Notification for Role Objects"
                    },
                    "displayName": "",
                    "nextStep": "End Step — Success 1",
                    "type": "action",
                    "versionNumber": 2
                }
            }
        },
        "enabled": false,
        "creator": {
            "type": "IDENTITY",
            "id": "628f08e9d3754deb94463c6380d0f61d",
            "name": "slpt.services"
        },
        "owner": {
            "type": "IDENTITY",
            "id": "628f08e9d3754deb94463c6380d0f61d",
            "name": "slpt.services"
        },
        "trigger": {
            "type": "EXTERNAL",
            "attributes": {
                "clientId": "7194bae8-581a-4e07-a2cc-1543741f3bd4",
                "description": "Child trigger to change leaver ownership of roles to manager",
                "id": "idn:external-http",
                "url": "/beta/workflows/execute/external/197b43da-4d8d-4b15-b5ee-edc7f22cac37"
            }
        }
    }
}