{
    "version": 1,
    "var_self": {
        "type": "WORKFLOW",
        "id": "885f7ebf-2b8b-4ef1-a021-7108c35eb11b",
        "name": "Certification Campaign Escalation 2"
    },
    "object": {
        "id": "885f7ebf-2b8b-4ef1-a021-7108c35eb11b",
        "name": "Certification Campaign Escalation 2",
        "description": "Certification Campaign second Escalation Email",
        "created": "2024-09-11T18:45:02.262218642Z",
        "modified": "2025-08-22T10:46:57.502824353Z",
        "modifiedBy": {
            "type": "IDENTITY",
            "id": "8b3c97da521442999ef05af532ecf6f7",
            "name": "rahul.majumder"
        },
        "definition": {
            "start": "Define Variable",
            "steps": {
                "Define Variable": {
                    "attributes": {
                        "id": "sp:define-variable",
                        "variables": [
                            {
                                "description": "",
                                "name": "campaignStartDate",
                                "transforms": [
                                    {
                                        "id": "sp:transform:substring:string",
                                        "input": {
                                            "length": 10,
                                            "start": 0
                                        }
                                    }
                                ],
                                "variableA.$": "$.now()"
                            }
                        ]
                    },
                    "displayName": "",
                    "nextStep": "Wait",
                    "type": "Mutation"
                },
                "End Step - Success 1": {
                    "displayName": "",
                    "type": "success"
                },
                "HTTP Request": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "method": "get",
                        "oAuthClientId": "b7984b0dd30b4d11a2063c9904cf6642",
                        "oAuthClientSecret": "$.secrets.64a0123c-d622-43f6-a123-d96c936867cb",
                        "oAuthCredentialLocation": "oAuthInHeader",
                        "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "url": "https://igmfinancial-uat.api.identitynow.com/v3/certifications",
                        "urlParams": {
                            "filters": "(campaign.id eq \"{{$.trigger.campaign.id}}\") and (phase eq \"ACTIVE\")"
                        }
                    },
                    "displayName": "",
                    "nextStep": "Loop",
                    "type": "action",
                    "versionNumber": 2
                },
                "Loop": {
                    "actionId": "sp:loop:iterator",
                    "attributes": {
                        "context.$": "$.defineVariable.campaignStartDate",
                        "input.$": "$.hTTPRequest.body",
                        "start": "Define Variable 1",
                        "steps": {
                            "Compare Strings": {
                                "choiceList": [
                                    {
                                        "comparator": "StringMatches",
                                        "nextStep": "End Step - Success",
                                        "variableA.$": "$.defineVariable1.excludedTitles",
                                        "variableB.$": "$.getIdentity1.attributes.title"
                                    }
                                ],
                                "defaultStep": "Get Identity 2",
                                "displayName": "",
                                "type": "choice"
                            },
                            "Compare Strings 1": {
                                "choiceList": [
                                    {
                                        "comparator": "StringMatches",
                                        "nextStep": "End Step - Success",
                                        "variableA.$": "$.defineVariable1.excludedTitles",
                                        "variableB.$": "$.getIdentity2.attributes.title"
                                    }
                                ],
                                "defaultStep": "Send Email",
                                "displayName": "",
                                "type": "choice"
                            },
                            "Define Variable 1": {
                                "attributes": {
                                    "id": "sp:define-variable",
                                    "variables": [
                                        {
                                            "description": "",
                                            "name": "excludedTitles",
                                            "transforms": [],
                                            "variableA": "President & CEO IGM,President & CEO IGWM,President & CEO MFC,EVP & Chief Financial Officer,EVP & Chief HR Officer - IGM,EVP & Chief Information Officer,EVP & Chief Risk Officer,EVP Chief Marketing Officer,EVP General Counsel,EVP Products and Solutions,President, IGM Financial, QuÃ©bec,CIO Fixed Income & MAS,CIO Equities,Chief Investment Strategist,Vice Chair of IG Wealth Management,Head of Process Design,Head of Mortgage, Insurance, and Banking,Head of Investment Solutions,Head of Financial Planning,Head of Compliance,Head of Client Experience"
                                        },
                                        {
                                            "description": "",
                                            "name": "campaignEndDate",
                                            "transforms": [
                                                {
                                                    "id": "sp:transform:addTime:time",
                                                    "input": {
                                                        "length": 5,
                                                        "unit": "days"
                                                    }
                                                },
                                                {
                                                    "id": "sp:transform:substring:string",
                                                    "input": {
                                                        "length": 10,
                                                        "start": 0
                                                    }
                                                }
                                            ],
                                            "variableA.$": "$.now()"
                                        }
                                    ]
                                },
                                "displayName": "",
                                "nextStep": "Get Identity",
                                "type": "Mutation"
                            },
                            "End Step - Success": {
                                "displayName": "",
                                "type": "success"
                            },
                            "Get Identity": {
                                "actionId": "sp:get-identity",
                                "attributes": {
                                    "id.$": "$.loop.loopInput.reviewer.id"
                                },
                                "displayName": "",
                                "nextStep": "Get Identity 1",
                                "type": "action",
                                "versionNumber": 2
                            },
                            "Get Identity 1": {
                                "actionId": "sp:get-identity",
                                "attributes": {
                                    "id.$": "$.getIdentity.managerRef.id"
                                },
                                "displayName": "",
                                "nextStep": "Compare Strings",
                                "type": "action",
                                "versionNumber": 2
                            },
                            "Get Identity 2": {
                                "actionId": "sp:get-identity",
                                "attributes": {
                                    "id.$": "$.getIdentity1.managerRef.id"
                                },
                                "displayName": "",
                                "nextStep": "Compare Strings 1",
                                "type": "action",
                                "versionNumber": 2
                            },
                            "Send Email": {
                                "actionId": "sp:send-email",
                                "attributes": {
                                    "body": "<p>Hi ${twoUpManagerFirstName},<br><br>The <strong>${campaignName}</strong> was initiated on ${campaignStartDate}, and we have since sent three reminders to&nbsp;<strong>${firstName} ${lastName}</strong> and asked their manager for assistance last week. The certification campaign is scheduled to end on ${campaignEndDate} at 5pm EST.<br><br>We are seeking your assistance to ensure ${firstName} ${lastName} completes their certification as soon as possible.<br><br>If the reviewer is on vacation or on leave and won&rsquo;t be able to complete the certification, please open a <a href=\"https://igmfinancial.service-now.com/snap?id=sc_cat_item&amp;sys_id=3f1dd0320a0a0b99000a53f7604a2ef9\">SNAP incident</a> to have the certification reassigned by the IAM Operations team. Include the name of the individual whose certification requires reassignment and the name of the individual to reassign it to.<br><br>We appreciate your help in reminding the reviewer of the importance of completing the mandatory certification to comply with our security standards. <br><br><strong>Note: Upon the closure of the campaign, all unreviewed access will be deemed not required and will be revoked. To avoid your team member's access being revoked, please ensure ${firstName} ${lastName} completes the attestation prior to the ${campaignEndDate} at 5pm EST.</strong><br><br>To learn more about certification campaigns, please click <a href=\"https://igmfinancial.service-now.com/snap?id=kb_article_view&amp;sysparm_article=KB0016063\">here</a> to review the Access Certification Overview and FAQ. <br><br>Thank you!<br>IAM Operations Team</p>",
                                    "context": {
                                        "campaignEndDate.$": "$.defineVariable1.campaignEndDate",
                                        "campaignName.$": "$.loop.loopInput.campaign.name",
                                        "campaignStartDate.$": "$.loop.context",
                                        "firstName.$": "$.getIdentity.attributes.firstname",
                                        "lastName.$": "$.getIdentity.attributes.lastname",
                                        "managerFirstName.$": "$.getIdentity1.attributes.firstname",
                                        "twoUpManagerFirstName.$": "$.getIdentity2.attributes.firstname"
                                    },
                                    "from": "",
                                    "recipientEmailList": [
                                        "{{$.getIdentity2.attributes.email}}",
                                        "{{$.getIdentity1.attributes.email}}",
                                        "{{$.getIdentity.attributes.email}}"
                                    ],
                                    "subject": "Action Required:  Final Reminder - ${campaignName}"
                                },
                                "displayName": "",
                                "nextStep": "End Step - Success",
                                "type": "action",
                                "versionNumber": 2
                            }
                        }
                    },
                    "displayName": "",
                    "nextStep": "End Step - Success 1",
                    "type": "action",
                    "versionNumber": 1
                },
                "Wait": {
                    "actionId": "sp:sleep",
                    "attributes": {
                        "duration": "1m",
                        "type": "waitFor"
                    },
                    "displayName": "",
                    "nextStep": "HTTP Request",
                    "type": "action",
                    "versionNumber": 1
                }
            }
        },
        "enabled": false,
        "creator": {
            "type": "IDENTITY",
            "id": "cf41145275194a66bd2989bcac443640",
            "name": "jyoti.gupta"
        },
        "owner": {
            "type": "IDENTITY",
            "id": "cf41145275194a66bd2989bcac443640",
            "name": "jyoti.gupta"
        },
        "trigger": {
            "type": "EVENT",
            "attributes": {
                "id": "idn:campaign-activated"
            }
        }
    }
}