{
    "version": 1,
    "var_self": {
        "type": "WORKFLOW",
        "id": "5091c2e0-123a-49d5-89b9-c4e3f4370cab",
        "name": "group membership"
    },
    "object": {
        "id": "5091c2e0-123a-49d5-89b9-c4e3f4370cab",
        "name": "group membership",
        "description": "",
        "created": "2025-07-10T13:32:16.636391259Z",
        "modified": "2025-08-20T09:57:58.254881882Z",
        "modifiedBy": {
            "type": "IDENTITY",
            "id": "8b3c97da521442999ef05af532ecf6f7",
            "name": "rahul.majumder"
        },
        "definition": {
            "start": "Wait",
            "steps": {
                "End Step - Success 1": {
                    "actionId": "sp:operator-success",
                    "displayName": "",
                    "type": "success"
                },
                "Get Identity": {
                    "actionId": "sp:get-identity",
                    "attributes": {
                        "id.$": "$.trigger.identity.id"
                    },
                    "displayName": "",
                    "nextStep": "HTTP Request",
                    "type": "action",
                    "versionNumber": 2
                },
                "HTTP Request": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "method": "get",
                        "oAuthClientId": "5dd67b3494ff4922b07840c0ee4314e7",
                        "oAuthClientSecret": "$.secrets.b33f6786-2dcc-4330-943e-fe4c1ae304fd",
                        "oAuthCredentialLocation": "oAuthInHeader",
                        "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "url": "https://igmfinancial-uat.api.identitynow.com/beta/workgroups",
                        "urlParams": {
                            "filters": "memberships.identityId eq \"{{$.trigger.identity.id}}\""
                        }
                    },
                    "displayName": "",
                    "nextStep": "Loop",
                    "type": "action",
                    "versionNumber": 2
                },
                "Loop": {
                    "actionId": "sp:loop:iterator",
                    "attributes": {
                        "context.$": "$.trigger",
                        "input.$": "$.hTTPRequest.body",
                        "start": "HTTP Request 1",
                        "steps": {
                            "End Step - Success": {
                                "actionId": "sp:operator-success",
                                "displayName": "",
                                "type": "success"
                            },
                            "Get Identity 1": {
                                "actionId": "sp:get-identity",
                                "attributes": {
                                    "id.$": "$.loop.context.identity.id"
                                },
                                "displayName": "",
                                "nextStep": "Send Email",
                                "type": "action",
                                "versionNumber": 2
                            },
                            "HTTP Request 1": {
                                "actionId": "sp:http",
                                "attributes": {
                                    "authenticationType": "OAuth",
                                    "jsonRequestBody": {
                                        "remove": [
                                            "{{$.loop.context.identity.id}}"
                                        ]
                                    },
                                    "method": "post",
                                    "oAuthClientId": "5dd67b3494ff4922b07840c0ee4314e7",
                                    "oAuthClientSecret": "$.secrets.f7467f0f-628c-456f-b80b-c0bfb1bef7a8",
                                    "oAuthCredentialLocation": "oAuthInHeader",
                                    "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                                    "requestContentType": "json",
                                    "url": "https://igmfinancial-uat.api.identitynow.com/v2/workgroups/{{$.loop.loopInput.id}}/members"
                                },
                                "displayName": "",
                                "nextStep": "Get Identity 1",
                                "type": "action",
                                "versionNumber": 2
                            },
                            "Send Email": {
                                "actionId": "sp:send-email",
                                "attributes": {
                                    "body": "<p>Dear {{$.loop.loopInput.owner.displayName}},</p>\n<p>You are receiving this notification because you are the owner of the following Governance Group:&nbsp;</p>\n<p>Governance Group Name:</p>\n<p>{{$.loop.loopInput.name}}&nbsp;</p>\n<p>Governance Group Description:</p>\n<p>{{$.loop.loopInput.description}}</p>\n<p>Please be advised that the following member of this Governance Group has been terminated and therefore removed as a member of the Governance Group:&nbsp;</p>\n<p>{{$.getIdentity1.attributes.displayName}}</p>\n<p>&nbsp;</p>\n<p>You can access the details of this Governance Group at the following link: &nbsp;</p>\n<p><a href=\"https://igmfinancial.service-now.com/snap?id=kb_article_view&amp;sysparm_article=KB0013953\">Corporate Employees - Access Items &ndash; Inventory with Owner and Approvers for Requests - Resource Centre</a></p>\n<p><br>As the owner of this Governance Group, you are responsible for overseeing the group&rsquo;s membership. &nbsp;If you wish to modify the membership of this Governance Group, please follow the instructions provided in the link below to submit a SNAP request.&nbsp;</p>\n<p><a href=\"https://igmfinancial.service-now.com/snap?id=sc_cat_item&amp;sys_id=a19553aadb27981095d0ddf5f49619ed&amp;sysparm_category=a8d60a5e1b115410afb584415b4bcb53\">Authorization Request - Resource Centre</a></p>\n<p><br>This is a system-generated email. Please do not respond to this email.</p>",
                                    "context": {},
                                    "recipientEmailList.$": "$.loop.loopInput.owner.displayName",
                                    "subject": "Removal of Membership Notification for Governance Group - {{$.loop.loopInput.name}}"
                                },
                                "displayName": "",
                                "nextStep": "End Step - Success",
                                "type": "action",
                                "versionNumber": 2
                            }
                        }
                    },
                    "displayName": "",
                    "nextStep": "End Step - Success 1",
                    "type": "action",
                    "versionNumber": 1
                },
                "Wait": {
                    "actionId": "sp:sleep",
                    "attributes": {
                        "duration": "2m",
                        "type": "waitFor"
                    },
                    "displayName": "",
                    "nextStep": "Get Identity",
                    "type": "action",
                    "versionNumber": 1
                }
            }
        },
        "enabled": false,
        "creator": {
            "type": "IDENTITY",
            "id": "8b3c97da521442999ef05af532ecf6f7",
            "name": "rahul.majumder"
        },
        "owner": {
            "type": "IDENTITY",
            "id": "8b3c97da521442999ef05af532ecf6f7",
            "name": "rahul.majumder"
        },
        "trigger": {
            "type": "EVENT",
            "attributes": {
                "filter.$": "$.changes[?(@.attribute=='cloudLifecycleState' && @.newValue=='terminated')]",
                "id": "idn:identity-attributes-changed"
            }
        }
    }
}