{
    "version": 1,
    "var_self": {
        "type": "WORKFLOW",
        "id": "34d0bcd1-2b22-4141-b296-f4dbaa35f5ff",
        "name": "role ownership"
    },
    "object": {
        "id": "34d0bcd1-2b22-4141-b296-f4dbaa35f5ff",
        "name": "role ownership",
        "description": "Child workflow (external trigger) for the parent leaver workflow that changes the ownership of roles from leaver to their manager.",
        "created": "2025-07-22T14:00:53.463633193Z",
        "modified": "2025-08-27T11:13:21.282848258Z",
        "modifiedBy": {
            "type": "IDENTITY",
            "id": "8b3c97da521442999ef05af532ecf6f7",
            "name": "rahul.majumder"
        },
        "definition": {
            "start": "HTTP Request",
            "steps": {
                "Compare Numbers": {
                    "actionId": "sp:compare-numbers",
                    "choiceList": [
                        {
                            "comparator": "NumericGreaterThan",
                            "nextStep": "Send Email",
                            "variableA.$": "$.hTTPRequest.body.length()",
                            "variableB": 0
                        }
                    ],
                    "defaultStep": "End Step — Success 1",
                    "displayName": "",
                    "type": "choice"
                },
                "End Step — Success 1": {
                    "actionId": "sp:operator-success",
                    "description": "End of active path",
                    "type": "success"
                },
                "HTTP Request": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "indices": [
                                "roles"
                            ],
                            "query": {
                                "query": "owner.id:{{$.trigger.leaverId.id}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "5dd67b3494ff4922b07840c0ee4314e7",
                        "oAuthClientSecret": "$.secrets.400cf7dd-4c8f-446c-9ef6-a5624a48bff2",
                        "oAuthCredentialLocation": "oAuthInHeader",
                        "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-uat.api.identitynow.com/v3/search?offset=0&limit=100",
                        "urlParams": null
                    },
                    "description": "get list of roles owned by this identity",
                    "displayName": "Get Roles",
                    "nextStep": "Loop",
                    "type": "action",
                    "versionNumber": 2
                },
                "Loop": {
                    "actionId": "sp:loop:iterator",
                    "attributes": {
                        "context.$": "$.trigger",
                        "input.$": "$.hTTPRequest.body",
                        "start": "HTTP Request 1",
                        "steps": {
                            "End Step — Success": {
                                "actionId": "sp:operator-success",
                                "type": "success"
                            },
                            "HTTP Request 1": {
                                "actionId": "sp:http",
                                "attributes": {
                                    "authenticationType": "OAuth",
                                    "jsonPatchRequestBody": [
                                        {
                                            "op": "replace",
                                            "path": "/owner",
                                            "value": {
                                                "id": "{{$.loop.context.managerRef.id}}",
                                                "type": "IDENTITY"
                                            }
                                        }
                                    ],
                                    "method": "patch",
                                    "oAuthClientId": "5dd67b3494ff4922b07840c0ee4314e7",
                                    "oAuthClientSecret": "$.secrets.9b9679fc-cfcf-4c1a-afd5-df2d4f3ed72d",
                                    "oAuthCredentialLocation": "oAuthInHeader",
                                    "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                                    "requestContentType": "json-patch+json",
                                    "requestHeaders": {
                                        "Content-Type": "application/json-patch+json"
                                    },
                                    "url": "https://igmfinancial-uat.api.identitynow.com/beta/roles/{{$.loop.loopInput.id}}"
                                },
                                "description": "look up each role and change owner",
                                "displayName": "Change Manager to Owner",
                                "nextStep": "End Step — Success",
                                "type": "action",
                                "versionNumber": 2
                            }
                        }
                    },
                    "nextStep": "Compare Numbers",
                    "type": "action",
                    "versionNumber": 1
                },
                "Send Email": {
                    "actionId": "sp:send-email",
                    "attributes": {
                        "body": "<p>Dear {{$.trigger.managerRef.name}},</p>\n<p class=\"MsoNormal\">Due to the termination/suspension of {{$.trigger.leaverId.name}}, ownership of the following Roles has been transferred to you:</p>\n<ul>#if($objsLen>1)#foreach ( $detail in ${objs} )\n<li>${detail.name}</li>\n#end #{else}\n\n<li>${objs.name}</li>\n#end\n</ul>\n<p class=\"MsoNormal\">You can access the details of these items at the following link:<br><a href=\"https://igmfinancial.service-now.com/snap?id=kb_article_view&amp;sysparm_article=KB0013953\">Corporate Employees - Access Items &ndash; Inventory with Owner and Approvers for Requests - Resource Centre</a></p>\n<p class=\"MsoNormal\">If you wish to transfer ownership to another individual, please follow the instructions provided in the link below to submit a SNAP request.</p>\n<p class=\"MsoNormal\"><a href=\"https://igmfinancial.service-now.com/snap?id=sc_cat_item&amp;sys_id=a19553aadb27981095d0ddf5f49619ed&amp;sysparm_category=a8d60a5e1b115410afb584415b4bcb53\">Authorization Request - Resource Centre</a></p>\n<p class=\"MsoNormal\">This is a system-generated email. Please do not respond to this email.</p>\n<p>Bonjour {{$.trigger.managerRef.name}},</p>\n<p class=\"MsoNormal\">En raison de la r&eacute;siliation du contrat/suspension de {{$.trigger.leaverId.name}}, la propri&eacute;t&eacute; des r&ocirc;les (Roles) suivants vous a &eacute;t&eacute; transf&eacute;r&eacute;e :</p>\n<ul>#if($objsLen>1)#foreach ( $detail in ${objs} )\n<li>${detail.name}</li>\n#end #{else}\n\n<li>${objs.name}</li>\n#end\n</ul>\n<p class=\"MsoNormal\">Vous pouvez obtenir des renseignements additionnels sur chaque &eacute;l&eacute;ment en cliquant sur le lien suivant :<br><a href=\"https://igmfinancial.service-now.com/snap?id=kb_article_view&amp;sysparm_article=KB0013953\">Page SNAP sur la propri&eacute;t&eacute; dans SailPoint</a></p>\n<p class=\"MsoNormal\">Si vous souhaitez transf&eacute;rer la propri&eacute;t&eacute; &agrave; une autre personne, veuillez soumettre une demande SNAP en suivant les instructions accessibles par le lien ci-dessous.</p>\n<p class=\"MsoNormal\"><a href=\"https://igmfinancial.service-now.com/snap?id=sc_cat_item&amp;sys_id=a19553aadb27981095d0ddf5f49619ed&amp;sysparm_category=a8d60a5e1b115410afb584415b4bcb53\">Demande d&rsquo;autorisation &ndash; Centre de ressources</a></p>\n<p class=\"MsoNormal\">Ce courriel a &eacute;t&eacute; produit par le syst&egrave;me. Veuillez ne pas y r&eacute;pondre.</p>",
                        "context": {
                            "objs.$": "$.hTTPRequest.body",
                            "objsLen.$": "$.hTTPRequest.body.length()"
                        },
                        "recipientEmailList.$": "$.trigger.managerRef.email",
                        "replyTo.$": "",
                        "subject": "Transfer of Ownership Notification for Role Objects/Avis de transfert de propriété de rôle"
                    },
                    "displayName": "",
                    "nextStep": "End Step — Success 1",
                    "type": "action",
                    "versionNumber": 2
                }
            }
        },
        "enabled": false,
        "creator": {
            "type": "IDENTITY",
            "id": "8b3c97da521442999ef05af532ecf6f7",
            "name": "rahul.majumder"
        },
        "owner": {
            "type": "IDENTITY",
            "id": "8b3c97da521442999ef05af532ecf6f7",
            "name": "rahul.majumder"
        },
        "trigger": {
            "type": "EXTERNAL",
            "attributes": {
                "clientId": "337c58f0-9a0b-45d2-b763-fb151072660d",
                "description": "Child trigger to change leaver ownership of roles to manager.",
                "id": "idn:external-http",
                "url": "https://igmfinancial-uat.api.identitynow.com/beta/workflows/execute/external/34d0bcd1-2b22-4141-b296-f4dbaa35f5ff"
            }
        }
    }
}