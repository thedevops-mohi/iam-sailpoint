{
    "version": 1,
    "var_self": {
        "type": "WORKFLOW",
        "id": "06710a4a-0efb-4d90-8d3d-759655524764",
        "name": "access profile ownership"
    },
    "object": {
        "id": "06710a4a-0efb-4d90-8d3d-759655524764",
        "name": "access profile ownership",
        "description": "Child workflow (external trigger) for the parent leaver workflow that changes the ownership of access profiles from leaver to their manager.",
        "created": "2025-08-01T12:13:10.513449711Z",
        "modified": "2025-08-28T10:21:36.573233468Z",
        "modifiedBy": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "definition": {
            "start": "HTTP Request",
            "steps": {
                "Compare Numbers": {
                    "actionId": "sp:compare-numbers",
                    "choiceList": [
                        {
                            "comparator": "NumericGreaterThan",
                            "nextStep": "Send Email",
                            "variableA.$": "$.hTTPRequest.body.length()",
                            "variableB": 0
                        }
                    ],
                    "defaultStep": "End Step — Success 1",
                    "displayName": "",
                    "type": "choice"
                },
                "End Step — Success 1": {
                    "actionId": "sp:operator-success",
                    "description": "End of active path",
                    "type": "success"
                },
                "HTTP Request": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "indices": [
                                "accessprofiles"
                            ],
                            "query": {
                                "query": "owner.id:{{$.trigger.leaverId.id}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "e84f31b591e747538d9071ed05c46546",
                        "oAuthClientSecret": "$.secrets.9c9c85ad-bfd5-4393-82b1-d18bbe055593",
                        "oAuthCredentialLocation": "oAuthInHeader",
                        "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-dev.api.identitynow.com/v3/search?offset=0&limit=100",
                        "urlParams": null
                    },
                    "description": "get list of access profiles owned by this identity.",
                    "displayName": "Get Access Profiles",
                    "nextStep": "Loop",
                    "type": "action",
                    "versionNumber": 2
                },
                "Loop": {
                    "actionId": "sp:loop:iterator",
                    "attributes": {
                        "context.$": "$.trigger",
                        "input.$": "$.hTTPRequest.body",
                        "start": "HTTP Request 1",
                        "steps": {
                            "End Step — Success": {
                                "actionId": "sp:operator-success",
                                "type": "success"
                            },
                            "HTTP Request 1": {
                                "actionId": "sp:http",
                                "attributes": {
                                    "authenticationType": "OAuth",
                                    "jsonPatchRequestBody": [
                                        {
                                            "op": "replace",
                                            "path": "/owner",
                                            "value": {
                                                "id": "{{$.loop.context.managerRef.id}}",
                                                "type": "IDENTITY"
                                            }
                                        }
                                    ],
                                    "method": "patch",
                                    "oAuthClientId": "e84f31b591e747538d9071ed05c46546",
                                    "oAuthClientSecret": "$.secrets.042c0b0f-62c0-4403-82b1-9c2a74a1555d",
                                    "oAuthCredentialLocation": "oAuthInHeader",
                                    "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                                    "requestContentType": "json-patch+json",
                                    "requestHeaders": {
                                        "Content-Type": "application/json-patch+json"
                                    },
                                    "url": "https://igmfinancial-dev.api.identitynow.com/beta/access-profiles/{{$.loop.loopInput.id}}"
                                },
                                "description": "look up each entitlement and change owner",
                                "displayName": "Change Owner to Manager",
                                "nextStep": "End Step — Success",
                                "type": "action",
                                "versionNumber": 2
                            }
                        }
                    },
                    "nextStep": "Compare Numbers",
                    "type": "action",
                    "versionNumber": 1
                },
                "Send Email": {
                    "actionId": "sp:send-email",
                    "attributes": {
                        "body": "<p>Dear {{$.trigger.managerRef.name}},</p>\n<p class=\"MsoNormal\">Due to the termination/suspension of {{$.trigger.leaverId.name}}, ownership of the following Access Profiles has been transferred to you:</p>\n<ul>#if($objsLen>1)#foreach ( $detail in ${objs} )\n<li>${detail.name}</li>\n#end #{else}\n\n<li>${objs.name}</li>\n#end\n</ul>\n<p class=\"MsoNormal\">You can access the details of these items at the following link:<br><a href=\"https://igmfinancial.service-now.com/snap?id=kb_article_view&amp;sysparm_article=KB0013953\">Corporate Employees - Access Items &ndash; Inventory with Owner and Approvers for Requests - Resource Centre</a></p>\n<p class=\"MsoNormal\">If you wish to transfer ownership to another individual, please follow the instructions provided in the link below to submit a SNAP request.<br><a href=\"https://igmfinancial.service-now.com/snap?id=sc_cat_item&amp;sys_id=a19553aadb27981095d0ddf5f49619ed&amp;sysparm_category=a8d60a5e1b115410afb584415b4bcb53\">Authorization Request - Resource Centre</a></p>\n<p class=\"MsoNormal\">This is a system-generated email. Please do not respond to this email.</p>\n<p>Bonjour {{$.trigger.managerRef.name}},</p>\n<p class=\"MsoNormal\">En raison de la r&eacute;siliation du contrat/suspension de {{$.trigger.leaverId.name}}, la propri&eacute;t&eacute; des profils d&rsquo;acc&egrave;s (Access Profiles) suivants vous a &eacute;t&eacute; transf&eacute;r&eacute;e :</p>\n<ul>#if($objsLen>1)#foreach ( $detail in ${objs} )\n<li>${detail.name}</li>\n#end #{else}\n\n<li>${objs.name}</li>\n#end\n</ul>\n<p class=\"MsoNormal\">Vous pouvez obtenir des renseignements additionnels sur chaque &eacute;l&eacute;ment en cliquant sur le lien suivant :<br><a href=\"https://igmfinancial.service-now.com/snap?id=kb_article_view&amp;sysparm_article=KB0013953\">Page SNAP sur la propri&eacute;t&eacute; dans SailPoint</a></p>\n<p class=\"MsoNormal\">Si vous souhaitez transf&eacute;rer la propri&eacute;t&eacute; &agrave; une autre personne, veuillez soumettre une demande SNAP en suivant les instructions accessibles par le lien ci-dessous.<br><a href=\"https://igmfinancial.service-now.com/snap?id=sc_cat_item&amp;sys_id=a19553aadb27981095d0ddf5f49619ed&amp;sysparm_category=a8d60a5e1b115410afb584415b4bcb53\">Demande d&rsquo;autorisation &ndash; Centre de ressources</a></p>\n<p class=\"MsoNormal\">Ce courriel a &eacute;t&eacute; produit par le syst&egrave;me. Veuillez ne pas y r&eacute;pondre.</p>",
                        "context": {
                            "objs.$": "$.hTTPRequest.body",
                            "objsLen.$": "$.hTTPRequest.body.length()"
                        },
                        "recipientEmailList.$": "$.trigger.managerRef.email",
                        "subject": "Transfer of Ownership Notification for Access Profile Objects/Avis de transfert de propriété de profil d’accès"
                    },
                    "displayName": "",
                    "nextStep": "End Step — Success 1",
                    "type": "action",
                    "versionNumber": 2
                }
            }
        },
        "enabled": true,
        "creator": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "owner": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "trigger": {
            "type": "EXTERNAL",
            "attributes": {
                "clientId": "73dcfb74-d8f0-45a8-b7dc-f5279762b296",
                "description": "change ownership of sources for leaver.",
                "id": "idn:external-http",
                "url": "https://igmfinancial-dev.api.identitynow.com/beta/workflows/execute/external/06710a4a-0efb-4d90-8d3d-759655524764"
            }
        }
    }
}