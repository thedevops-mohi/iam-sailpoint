{
    "version": 1,
    "var_self": {
        "type": "WORKFLOW",
        "id": "09d2ef9b-7f4b-42ed-bfa4-9a2211a8ce30",
        "name": "SailPoint PS - Reassign Governance Group Membership"
    },
    "object": {
        "id": "09d2ef9b-7f4b-42ed-bfa4-9a2211a8ce30",
        "name": "SailPoint PS - Reassign Governance Group Membership",
        "description": "Child workflow (external trigger) for the parent leaver workflow that searches all governance groups, then searches within the membership of those groups for the leaver identity and finally, changes the membership of those governance groups from the leaver to their manager. (Two child workflows from this part 1)",
        "created": "2025-08-21T14:24:51.135732151Z",
        "modified": "2025-08-21T15:55:05.443067055Z",
        "modifiedBy": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "definition": {
            "start": "Get governance groups",
            "steps": {
                "Compare Numbers": {
                    "actionId": "sp:compare-numbers",
                    "choiceList": [
                        {
                            "comparator": "NumericGreaterThan",
                            "nextStep": "Send Email",
                            "variableA.$": "$.getGovernanceGroups.body.length()",
                            "variableB": 0
                        }
                    ],
                    "defaultStep": "success 1",
                    "displayName": "",
                    "type": "choice"
                },
                "Get governance groups": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "method": "get",
                        "oAuthClientId": "e84f31b591e747538d9071ed05c46546",
                        "oAuthClientSecret": "$.secrets.d6a21c1d-96ad-4cf0-b23f-94ef2b9c42b4",
                        "oAuthCredentialLocation": "oAuthInHeader",
                        "oAuthScope": null,
                        "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": "",
                        "url": "https://igmfinancial-dev.api.identitynow.com/beta/workgroups",
                        "urlParams": {
                            "filters": "memberships.identityId eq \"{{$.trigger.leaverId.id}}\""
                        }
                    },
                    "description": "Get ... all workgroups",
                    "nextStep": "Loop",
                    "type": "action",
                    "versionNumber": 2
                },
                "Loop": {
                    "actionId": "sp:loop:iterator",
                    "attributes": {
                        "context.$": "$.trigger",
                        "input.$": "$.getGovernanceGroups.body",
                        "start": "HTTP Request",
                        "steps": {
                            "End Step — Success": {
                                "actionId": "sp:operator-success",
                                "type": "success"
                            },
                            "HTTP Request": {
                                "actionId": "sp:http",
                                "attributes": {
                                    "authenticationType": "OAuth",
                                    "jsonRequestBody": {
                                        "add": [
                                            "{{$.loop.context.managerRef.id}}"
                                        ],
                                        "remove": [
                                            "{{$.loop.context.leaverId.id}}"
                                        ]
                                    },
                                    "method": "post",
                                    "oAuthClientId": "e84f31b591e747538d9071ed05c46546",
                                    "oAuthClientSecret": "$.secrets.2d4c993c-7b60-40fc-b403-4e6a74a666e5",
                                    "oAuthCredentialLocation": "oAuthInHeader",
                                    "oAuthScope": null,
                                    "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                                    "requestContentType": "json",
                                    "requestHeaders": null,
                                    "textRequestBody": "[{\"id\":\"{{$.loop.context.managerRef.id}}\",\"name\":\"{{$.loop.context.managerRef.name}}\",\"type\":\"IDENTITY\"}]",
                                    "url": "https://igmfinancial-dev.api.identitynow.com/v2/workgroups/{{$.loop.loopInput.id}}/members"
                                },
                                "displayName": "Add a member",
                                "nextStep": "End Step — Success",
                                "type": "action",
                                "versionNumber": 2
                            }
                        }
                    },
                    "nextStep": "Compare Numbers",
                    "type": "action",
                    "versionNumber": 1
                },
                "Send Email": {
                    "actionId": "sp:send-email",
                    "attributes": {
                        "body": "<p>Dear {{$.trigger.managerRef.name}},</p>\n<p class=\"MsoNormal\">Due to the off-boarding of {{$.trigger.leaverId.name}}, you have been added to the following Governance Groups:</p>\n<ul>#if($objsLen>1)#foreach ( $detail in ${objs} )\n<li>${detail.name}</li>\n#end #{else}\n\n<li>${objs.name}</li>\n#end\n</ul>\n<p class=\"MsoNormal\">You can access the details of these items at the following link:&nbsp;<br><a href=\"https://igmfinancial.service-now.com/snap?id=kb_article_view&amp;sysparm_article=KB0013953\">Corporate Employees - Access Items &ndash; Inventory with Owner and Approvers for Requests - Resource Centre</a></p>\n<p class=\"MsoNormal\">If you wish to transfer membership to another individual, please follow the instructions provided in the link below to submit a SNAP request.<br><a href=\"https://igmfinancial.service-now.com/snap?id=sc_cat_item&amp;sys_id=a19553aadb27981095d0ddf5f49619ed&amp;sysparm_category=a8d60a5e1b115410afb584415b4bcb53\">Authorization Request - Resource Centre</a></p>\n<p class=\"MsoNormal\">This is a system-generated email. Please do not respond to this email.</p>",
                        "context": {
                            "objs.$": "$.getGovernanceGroups.body",
                            "objsLen.$": "$.getGovernanceGroups.body.length()"
                        },
                        "from.$": "",
                        "recipientEmailList.$": "$.trigger.managerRef.email",
                        "subject": "Transfer of Membership Notification for Governance Group Objects"
                    },
                    "nextStep": "success 1",
                    "type": "action",
                    "versionNumber": 2
                },
                "success 1": {
                    "actionId": "sp:operator-success",
                    "type": "success"
                }
            }
        },
        "enabled": false,
        "creator": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "owner": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "trigger": {
            "type": "EXTERNAL",
            "attributes": {
                "clientId": "6e0b9647-e2b8-4235-8328-9a82afc65abf",
                "description": "step one of gathering gov groups to be searched for leaver as member.",
                "id": "idn:external-http",
                "url": "https://igmfinancial-dev.api.identitynow.com/beta/workflows/execute/external/09d2ef9b-7f4b-42ed-bfa4-9a2211a8ce30"
            }
        }
    }
}