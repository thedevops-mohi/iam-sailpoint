{
    "version": 1,
    "var_self": {
        "type": "WORKFLOW",
        "id": "d0edb0a5-0b43-4e9e-b1ea-3b02c275a884",
        "name": "governancegroup ownership"
    },
    "object": {
        "id": "d0edb0a5-0b43-4e9e-b1ea-3b02c275a884",
        "name": "governancegroup ownership",
        "description": "process a list of entitlements for a target source",
        "created": "2025-07-22T14:17:05.34312085Z",
        "modified": "2025-08-05T14:06:00.982966042Z",
        "modifiedBy": {
            "type": "IDENTITY",
            "id": "8b3c97da521442999ef05af532ecf6f7",
            "name": "rahul.majumder"
        },
        "definition": {
            "start": "Get Identity",
            "steps": {
                "End Step - Failure": {
                    "actionId": "sp:operator-failure",
                    "description": "GET search API HTTP request failed",
                    "displayName": "",
                    "failureDetails": "need to figure out http request body most likely.",
                    "failureName": "Search API call error",
                    "type": "failure"
                },
                "End Step - Success 1": {
                    "actionId": "sp:operator-success",
                    "displayName": "",
                    "type": "success"
                },
                "Get Identity": {
                    "actionId": "sp:get-identity",
                    "attributes": {
                        "id.$": "$.trigger.leaverId.id"
                    },
                    "description": "Get full details on the identity in question",
                    "displayName": "",
                    "nextStep": "HTTP Request",
                    "type": "action",
                    "versionNumber": 2
                },
                "HTTP Request": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "indices": [
                                "identities"
                            ],
                            "query": {
                                "query": "id: {{$.getIdentity.id}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "5dd67b3494ff4922b07840c0ee4314e7",
                        "oAuthClientSecret": "$.secrets.4be41b04-5996-408b-9a3e-a8898c027932",
                        "oAuthCredentialLocation": "oAuthInHeader",
                        "oAuthScope": null,
                        "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "url": "https://igmfinancial-uat.api.identitynow.com/v2024/search"
                    },
                    "catch": [
                        {
                            "next": "End Step - Failure"
                        }
                    ],
                    "description": "Use the output of an identity search to get entitlements",
                    "displayName": "",
                    "nextStep": "Loop",
                    "type": "action",
                    "versionNumber": 2
                },
                "Loop": {
                    "actionId": "sp:loop:iterator",
                    "attributes": {
                        "context.$": "$",
                        "input.$": "$.hTTPRequest.body.*.owns.governanceGroups",
                        "start": "HTTP Request 1",
                        "steps": {
                            "End Step - Success": {
                                "actionId": "sp:operator-success",
                                "displayName": "",
                                "type": "success"
                            },
                            "HTTP Request 1": {
                                "actionId": "sp:http",
                                "attributes": {
                                    "authenticationType": "OAuth",
                                    "jsonRequestBody": {
                                        "owner": {
                                            "id": "{{$.loop.context.getIdentity.managerRef.id}}"
                                        }
                                    },
                                    "method": "patch",
                                    "oAuthClientId": "5dd67b3494ff4922b07840c0ee4314e7",
                                    "oAuthClientSecret": "$.secrets.d4a4a7e7-b4bd-49d6-ace7-6b2d52c82faf",
                                    "oAuthCredentialLocation": "oAuthInHeader",
                                    "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                                    "requestContentType": "json",
                                    "url": "https://igmfinancial-uat.api.identitynow.com/v2/workgroups/{{$.loop.loopInput.id}}"
                                },
                                "displayName": "",
                                "nextStep": "HTTP Request 2",
                                "type": "action",
                                "versionNumber": 2
                            },
                            "HTTP Request 2": {
                                "actionId": "sp:http",
                                "attributes": {
                                    "authenticationType": "OAuth",
                                    "jsonRequestBody": {
                                        "add": [
                                            "{{$.loop.context.getIdentity.managerRef.id}}"
                                        ]
                                    },
                                    "method": "post",
                                    "oAuthClientId": "5dd67b3494ff4922b07840c0ee4314e7",
                                    "oAuthClientSecret": "$.secrets.63caa428-0efa-4d23-93d7-4abf45bdf7fa",
                                    "oAuthCredentialLocation": "oAuthInHeader",
                                    "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                                    "requestContentType": "json",
                                    "url": "https://igmfinancial-uat.api.identitynow.com/v2/workgroups/{{$.loop.loopInput.id}}/members"
                                },
                                "displayName": "",
                                "nextStep": "HTTP Request 3",
                                "type": "action",
                                "versionNumber": 2
                            },
                            "HTTP Request 3": {
                                "actionId": "sp:http",
                                "attributes": {
                                    "authenticationType": "OAuth",
                                    "method": "get",
                                    "oAuthClientId": "5dd67b3494ff4922b07840c0ee4314e7",
                                    "oAuthClientSecret": "$.secrets.b1cae6b7-97cd-4356-af0a-6e5f4a1700b2",
                                    "oAuthCredentialLocation": "oAuthInHeader",
                                    "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                                    "url": "https://igmfinancial-uat.api.identitynow.com/beta/workgroups",
                                    "urlParams": {
                                        "filters": "id eq \"{{$.loop.loopInput.id}}\""
                                    }
                                },
                                "displayName": "",
                                "nextStep": "Send Email",
                                "type": "action",
                                "versionNumber": 2
                            },
                            "Send Email": {
                                "actionId": "sp:send-email",
                                "attributes": {
                                    "body": "<p>Dear {{$.loop.context.getIdentity.managerRef.name}},</p>\n<p>Due to the termination/suspension of {{$.loop.context.getIdentity.name}}, ownership of the following Governance Group has been transferred to you:</p>\n<p><span class=\"NormalTextRun SCXW118121221 BCX8\">Governance Group Name:</span></p>\n<p>{{$.loop.loopInput.name}}</p>\n<p><span class=\"NormalTextRun SCXW138093138 BCX8\">Governance Group Description:</span></p>\n<p>{{$.hTTPRequest3.body.*.description}}</p>\n<p>You can access the details of this item at the following link:<br><br><a href=\"https://igmfinancial.service-now.com/snap?id=kb_article_view&amp;sysparm_article=KB0013953\">Corporate Employees - Access Items &ndash; Inventory with Owner and Approvers for Requests - Resource Centre</a></p>\n<p><span class=\"TextRun SCXW158673015 BCX8\" lang=\"EN-US\" xml:lang=\"EN-US\" data-contrast=\"auto\"><span class=\"NormalTextRun SCXW158673015 BCX8\">As the new owner</span><span class=\"NormalTextRun SCXW158673015 BCX8\"> of this Governance Group</span><span class=\"NormalTextRun SCXW158673015 BCX8\">, you </span><span class=\"NormalTextRun SCXW158673015 BCX8\">are </span><span class=\"NormalTextRun SCXW158673015 BCX8\">responsible for</span><span class=\"NormalTextRun SCXW158673015 BCX8\"> overseeing the group</span><span class=\"NormalTextRun SCXW158673015 BCX8\">&rsquo;s membership</span><span class=\"NormalTextRun SCXW158673015 BCX8\">.&nbsp; </span><span class=\"NormalTextRun SCXW158673015 BCX8\">If you wish to transfer ownership to another individual, please follow the instructions provided in the link below to </span><span class=\"NormalTextRun SCXW158673015 BCX8\">submit</span><span class=\"NormalTextRun SCXW158673015 BCX8\"> a SNAP request.</span></span><span class=\"EOP SCXW158673015 BCX8\" data-ccp-props=\"{&quot;335559685&quot;:720,&quot;335559738&quot;:240,&quot;335559739&quot;:240}\">&nbsp;</span></p>\n<p><a href=\"https://igmfinancial.service-now.com/snap?id=sc_cat_item&amp;sys_id=a19553aadb27981095d0ddf5f49619ed&amp;sysparm_category=a8d60a5e1b115410afb584415b4bcb53\">Authorization Request - Resource Centre</a></p>\n<p>This is a system-generated email. Please do not respond to this email.</p>",
                                    "context": {},
                                    "recipientEmailList.$": "$.loop.context.getIdentity.managerRef.name",
                                    "subject": "Transfer of Ownership Notification for Governance Group – {{$.loop.loopInput.name}}"
                                },
                                "displayName": "",
                                "nextStep": "End Step - Success",
                                "type": "action",
                                "versionNumber": 2
                            }
                        }
                    },
                    "displayName": "",
                    "nextStep": "End Step - Success 1",
                    "type": "action",
                    "versionNumber": 1
                }
            }
        },
        "enabled": true,
        "creator": {
            "type": "IDENTITY",
            "id": "8b3c97da521442999ef05af532ecf6f7",
            "name": "rahul.majumder"
        },
        "owner": {
            "type": "IDENTITY",
            "id": "8b3c97da521442999ef05af532ecf6f7",
            "name": "rahul.majumder"
        },
        "trigger": {
            "type": "EXTERNAL",
            "attributes": {
                "clientId": "4509badc-3471-4b31-8fbb-468810d1e1a2",
                "description": ".",
                "id": "idn:external-http",
                "url": "https://igmfinancial-uat.api.identitynow.com/beta/workflows/execute/external/d0edb0a5-0b43-4e9e-b1ea-3b02c275a884"
            }
        }
    }
}