{
    "version": 1,
    "var_self": {
        "type": "WORKFLOW",
        "id": "0eacb9cb-2aa9-46cf-9fd4-e9a47105aa75",
        "name": "governancegroup ownership"
    },
    "object": {
        "id": "0eacb9cb-2aa9-46cf-9fd4-e9a47105aa75",
        "name": "governancegroup ownership",
        "description": "process a list of entitlements for a target source",
        "created": "2025-08-01T12:17:55.775592888Z",
        "modified": "2025-08-28T10:21:30.375262764Z",
        "modifiedBy": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "definition": {
            "start": "Get Identity",
            "steps": {
                "End Step - Failure": {
                    "actionId": "sp:operator-failure",
                    "description": "GET search API HTTP request failed",
                    "displayName": "",
                    "failureDetails": "need to figure out http request body most likely.",
                    "failureName": "Search API call error",
                    "type": "failure"
                },
                "End Step - Success 1": {
                    "actionId": "sp:operator-success",
                    "displayName": "",
                    "type": "success"
                },
                "Get Identity": {
                    "actionId": "sp:get-identity",
                    "attributes": {
                        "id.$": "$.trigger.leaverId.id"
                    },
                    "description": "Get full details on the identity in question",
                    "displayName": "",
                    "nextStep": "HTTP Request",
                    "type": "action",
                    "versionNumber": 2
                },
                "HTTP Request": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "indices": [
                                "identities"
                            ],
                            "query": {
                                "query": "id: {{$.getIdentity.id}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "e84f31b591e747538d9071ed05c46546",
                        "oAuthClientSecret": "$.secrets.a6c5cdfa-df56-4b15-8b14-558a88ddfe40",
                        "oAuthCredentialLocation": "oAuthInHeader",
                        "oAuthScope": null,
                        "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "url": "https://igmfinancial-dev.api.identitynow.com/v2024/search"
                    },
                    "catch": [
                        {
                            "next": "End Step - Failure"
                        }
                    ],
                    "description": "Use the output of an identity search to get entitlements",
                    "displayName": "",
                    "nextStep": "Loop",
                    "type": "action",
                    "versionNumber": 2
                },
                "Loop": {
                    "actionId": "sp:loop:iterator",
                    "attributes": {
                        "context.$": "$",
                        "input.$": "$.hTTPRequest.body.*.owns.governanceGroups",
                        "start": "HTTP Request 1",
                        "steps": {
                            "End Step - Success": {
                                "actionId": "sp:operator-success",
                                "displayName": "",
                                "type": "success"
                            },
                            "HTTP Request 1": {
                                "actionId": "sp:http",
                                "attributes": {
                                    "authenticationType": "OAuth",
                                    "jsonRequestBody": {
                                        "owner": {
                                            "id": "{{$.loop.context.getIdentity.managerRef.id}}"
                                        }
                                    },
                                    "method": "patch",
                                    "oAuthClientId": "e84f31b591e747538d9071ed05c46546",
                                    "oAuthClientSecret": "$.secrets.17063706-4205-46e3-8ba6-49a9a3a934b8",
                                    "oAuthCredentialLocation": "oAuthInHeader",
                                    "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                                    "requestContentType": "json",
                                    "url": "https://igmfinancial-dev.api.identitynow.com/v2/workgroups/{{$.loop.loopInput.id}}"
                                },
                                "displayName": "",
                                "nextStep": "HTTP Request 2",
                                "type": "action",
                                "versionNumber": 2
                            },
                            "HTTP Request 2": {
                                "actionId": "sp:http",
                                "attributes": {
                                    "authenticationType": "OAuth",
                                    "jsonRequestBody": {
                                        "add": [
                                            "{{$.loop.context.getIdentity.managerRef.id}}"
                                        ]
                                    },
                                    "method": "post",
                                    "oAuthClientId": "e84f31b591e747538d9071ed05c46546",
                                    "oAuthClientSecret": "$.secrets.8b6a7b8e-f0ae-4e36-901e-c1d0aefcad85",
                                    "oAuthCredentialLocation": "oAuthInHeader",
                                    "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                                    "requestContentType": "json",
                                    "url": "https://igmfinancial-dev.api.identitynow.com/v2/workgroups/{{$.loop.loopInput.id}}/members"
                                },
                                "displayName": "",
                                "nextStep": "HTTP Request 3",
                                "type": "action",
                                "versionNumber": 2
                            },
                            "HTTP Request 3": {
                                "actionId": "sp:http",
                                "attributes": {
                                    "authenticationType": "OAuth",
                                    "method": "get",
                                    "oAuthClientId": "e84f31b591e747538d9071ed05c46546",
                                    "oAuthClientSecret": "$.secrets.e0678857-7cca-42d7-b0a3-70b948355ab3",
                                    "oAuthCredentialLocation": "oAuthInHeader",
                                    "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                                    "url": "https://igmfinancial-dev.api.identitynow.com/beta/workgroups",
                                    "urlParams": {
                                        "filters": "id eq \"{{$.loop.loopInput.id}}\""
                                    }
                                },
                                "displayName": "",
                                "nextStep": "Send Email",
                                "type": "action",
                                "versionNumber": 2
                            },
                            "Send Email": {
                                "actionId": "sp:send-email",
                                "attributes": {
                                    "body": "<p>Dear {{$.loop.context.getIdentity.managerRef.name}},</p>\n<p>Due to the termination/suspension of {{$.loop.context.getIdentity.name}}, ownership of the following Governance Group has been transferred to you:</p>\n<p><span class=\"NormalTextRun SCXW118121221 BCX8\">Governance Group Name:</span></p>\n<p>{{$.loop.loopInput.name}}</p>\n<p><span class=\"NormalTextRun SCXW138093138 BCX8\">Governance Group Description:</span></p>\n<p>{{$.hTTPRequest3.body.*.description}}</p>\n<p>You can access the details of this item at the following link:<br><br><a href=\"https://igmfinancial.service-now.com/snap?id=kb_article_view&amp;sysparm_article=KB0013953\">Corporate Employees - Access Items &ndash; Inventory with Owner and Approvers for Requests - Resource Centre</a></p>\n<p><span class=\"TextRun SCXW158673015 BCX8\" lang=\"EN-US\" xml:lang=\"EN-US\" data-contrast=\"auto\"><span class=\"NormalTextRun SCXW158673015 BCX8\">As the new owner</span><span class=\"NormalTextRun SCXW158673015 BCX8\"> of this Governance Group</span><span class=\"NormalTextRun SCXW158673015 BCX8\">, you </span><span class=\"NormalTextRun SCXW158673015 BCX8\">are </span><span class=\"NormalTextRun SCXW158673015 BCX8\">responsible for</span><span class=\"NormalTextRun SCXW158673015 BCX8\"> overseeing the group</span><span class=\"NormalTextRun SCXW158673015 BCX8\">&rsquo;s membership</span><span class=\"NormalTextRun SCXW158673015 BCX8\">.&nbsp; </span><span class=\"NormalTextRun SCXW158673015 BCX8\">If you wish to transfer ownership to another individual, please follow the instructions provided in the link below to </span><span class=\"NormalTextRun SCXW158673015 BCX8\">submit</span><span class=\"NormalTextRun SCXW158673015 BCX8\"> a SNAP request.</span></span><span class=\"EOP SCXW158673015 BCX8\" data-ccp-props=\"{&quot;335559685&quot;:720,&quot;335559738&quot;:240,&quot;335559739&quot;:240}\">&nbsp;</span></p>\n<p><a href=\"https://igmfinancial.service-now.com/snap?id=sc_cat_item&amp;sys_id=a19553aadb27981095d0ddf5f49619ed&amp;sysparm_category=a8d60a5e1b115410afb584415b4bcb53\">Authorization Request - Resource Centre</a></p>\n<p>This is a system-generated email. Please do not respond to this email.</p>\n<p>Bonjour {{$.loop.context.getIdentity.managerRef.name}},</p>\n<p>En raison de la r&eacute;siliation ou de la suspension du contrat de {{$.loop.context.getIdentity.name}}, la propri&eacute;t&eacute; du groupe de gouvernance suivant vous a &eacute;t&eacute; transf&eacute;r&eacute;e:</p>\n<p>Nom du groupe de gouvernance:</p>\n<p>{{$.loop.loopInput.name}}</p>\n<p>Description du groupe de gouvernance:</p>\n<p>{{$.hTTPRequest3.body.*.description}}</p>\n<p>Pour consulter les renseignements propres &agrave; ce groupe de gouvernance, cliquez sur le lien suivant:</p>\n<p><a href=\"https://igmfinancial.service-now.com/snap?id=kb_article_view&amp;sysparm_article=KB0013953\">Page SNAP sur la propri&eacute;t&eacute; dans SailPoint</a></p>\n<p>&Agrave; titre de propri&eacute;taire de ce groupe de gouvernance, vous avez la responsabilit&eacute; de maintenir &agrave; jour la liste des membres du groupe. Si vous souhaitez transf&eacute;rer la propri&eacute;t&eacute; &agrave; une autre personne, veuillez soumettre une demande SNAP en suivant les instructions accessibles par le lien ci-dessous.</p>\n<p><a href=\"https://igmfinancial.service-now.com/snap?id=sc_cat_item&amp;sys_id=a19553aadb27981095d0ddf5f49619ed&amp;sysparm_category=a8d60a5e1b115410afb584415b4bcb53\">Demande d&rsquo;autorisation &ndash; Centre de ressources</a></p>\n<p>Ce courriel a &eacute;t&eacute; produit par le syst&egrave;me. Veuillez ne pas y r&eacute;pondre.</p>",
                                    "context": {},
                                    "recipientEmailList.$": "$.loop.context.getIdentity.managerRef.name",
                                    "subject": "Transfer of Ownership Notification for Governance Group – {{$.loop.loopInput.name}}/Avis de transfert de propriété d’un groupe de gouvernance – {{$.loop.loopInput.name}}"
                                },
                                "displayName": "",
                                "nextStep": "End Step - Success",
                                "type": "action",
                                "versionNumber": 2
                            }
                        }
                    },
                    "displayName": "",
                    "nextStep": "End Step - Success 1",
                    "type": "action",
                    "versionNumber": 1
                }
            }
        },
        "enabled": true,
        "creator": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "owner": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "trigger": {
            "type": "EXTERNAL",
            "attributes": {
                "clientId": "9e339346-a0bd-4b87-b0e4-bcb37038200e",
                "id": "idn:external-http",
                "url": "https://igmfinancial-dev.api.identitynow.com/beta/workflows/execute/external/0eacb9cb-2aa9-46cf-9fd4-e9a47105aa75"
            }
        }
    }
}