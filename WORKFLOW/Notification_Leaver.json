{
    "version": 1,
    "var_self": {
        "type": "WORKFLOW",
        "id": "8047eb95-deb1-4e9c-8412-1df8c48759a2",
        "name": "Notification Leaver"
    },
    "object": {
        "id": "8047eb95-deb1-4e9c-8412-1df8c48759a2",
        "name": "Notification Leaver",
        "description": "Lifecycle state changed to terminated",
        "created": "2025-06-26T11:16:07.232738976Z",
        "modified": "2025-06-26T11:16:07.232738976Z",
        "modifiedBy": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "definition": {
            "start": "Compare Strings",
            "steps": {
                "Compare Strings": {
                    "choiceList": [
                        {
                            "comparator": "StringEquals",
                            "nextStep": "Get Identity",
                            "variableA.$": "$.trigger.changes[?(@.attribute=='cloudLifecycleState')].newValue",
                            "variableB": "terminated"
                        }
                    ],
                    "defaultStep": "success",
                    "description": "Suspended?",
                    "type": "choice"
                },
                "Compare Strings 1": {
                    "choiceList": [
                        {
                            "comparator": "StringEquals",
                            "nextStep": "Send Email 1",
                            "variableA.$": "$.getIdentity.attributes.userType",
                            "variableB": "Advisor"
                        }
                    ],
                    "defaultStep": "Get Identity 1",
                    "description": "Check if an advisor, they don't have a manager so we have to handle differently",
                    "type": "choice"
                },
                "Get Identity": {
                    "actionId": "sp:get-identity",
                    "attributes": {
                        "id.$": "$.trigger.identity.id"
                    },
                    "description": "Get Identity Information",
                    "nextStep": "Compare Strings 1",
                    "type": "action",
                    "versionNumber": 2
                },
                "Get Identity 1": {
                    "actionId": "sp:get-identity",
                    "attributes": {
                        "id.$": "$.getIdentity.managerRef.id"
                    },
                    "description": "Get Manager Identity Information for email",
                    "nextStep": "Send Email",
                    "type": "action",
                    "versionNumber": 2
                },
                "Send Email": {
                    "actionId": "sp:send-email",
                    "attributes": {
                        "body": "<p>Dear ${managerFirstName} ${managerLastName},<br><br>All system access has been disabled and all application accounts will be deleted in 21 days for: <br><br>Name: ${firstName} ${lastName}<br>Username: ${sAMAccountName}<br><br>If this was processed in error, please contact the IGM Service Desk.<br><br>IGM Service Desk <br>Mon &ndash; Fri 7:30 am to 7:30 pm ET<br>Phone Number: 1-800-661-2040<br>SNAP Portal &ndash; Live Chat / Get Help<br>https://igmfinancial.service-now.com/snap<br><br>This is a system-generated email. Please do not respond to this email.<br><br><br>Bonjour ${managerFirstName} ${managerLastName},<br><br>Tous les acc&egrave;s au syst&egrave;me ont &eacute;t&eacute; d&eacute;sactiv&eacute;s et tous les comptes d&rsquo;application seront supprim&eacute;s dans un d&eacute;lai de 21 jours pour : <br><br>Nom : ${firstName} ${lastName}<br>Nom d&rsquo;utilisateur : ${sAMAccountName}<br><br>Si le retrait a &eacute;t&eacute; op&eacute;r&eacute; par erreur, veuillez communiquer avec le Bureau des services technologiques d&rsquo;IGM. <br><br>Bureau des services technologiques d&rsquo;IGM <br>Lundi au vendredi de 7 h 30 &agrave; 19 h 30 (HE) <br>Num&eacute;ro de t&eacute;l&eacute;phone : 1-800-661-2040 <br>Portail SNAP/Clavardage en direct/Aide <br>https://igmfinancial.service-now.com/snap&nbsp;<br><br>Ce courriel a &eacute;t&eacute; produit par le syst&egrave;me. Veuillez ne pas y r&eacute;pondre.</p>",
                        "context": {
                            "firstName.$": "$.getIdentity.attributes.firstname",
                            "lastName.$": "$.getIdentity.attributes.lastname",
                            "managerFirstName.$": "$.getIdentity1.attributes.firstname",
                            "managerLastName.$": "$.getIdentity1.attributes.lastname",
                            "sAMAccountName.$": "$.getIdentity.attributes.samaccountname"
                        },
                        "from": null,
                        "recipientEmailList.$": "$.getIdentity1.attributes.email",
                        "replyTo": "",
                        "subject": "Offboarding Complete for ${firstName} ${lastName} / Retrait d’utilisateur effectué pour ${firstName} ${lastName}"
                    },
                    "description": "Send email to manager",
                    "nextStep": "success",
                    "type": "action",
                    "versionNumber": 2
                },
                "Send Email 1": {
                    "actionId": "sp:send-email",
                    "attributes": {
                        "body": "<p>Dear Field Network Administration,<br><br>All system access has been disabled and all application accounts will be deleted in 21 days for: <br><br>Name: ${firstName} ${lastName}<br>Username: ${sAMAccountName}<br><br>If this was processed in error, please contact the IGM Service Desk.<br><br>IGM Service Desk <br>Mon &ndash; Fri 7:30 am to 7:30 pm ET<br>Phone Number: 1-800-661-2040<br>SNAP Portal &ndash; Live Chat / Get Help<br>https://igmfinancial.service-now.com/snap<br><br>This is a system-generated email. Please do not respond to this email.<br><br><br>Bonjour Field Network Administration,<br><br>Tous les acc&egrave;s au syst&egrave;me ont &eacute;t&eacute; d&eacute;sactiv&eacute;s et tous les comptes d&rsquo;application seront supprim&eacute;s dans un d&eacute;lai de 21 jours pour : <br><br>Nom : ${firstName} ${lastName}<br>Nom d&rsquo;utilisateur : ${sAMAccountName}<br><br>Si le retrait a &eacute;t&eacute; op&eacute;r&eacute; par erreur, veuillez communiquer avec le Bureau des services technologiques d&rsquo;IGM. <br><br>Bureau des services technologiques d&rsquo;IGM <br>Lundi au vendredi de 7 h 30 &agrave; 19 h 30 (HE) <br>Num&eacute;ro de t&eacute;l&eacute;phone : 1-800-661-2040 <br>Portail SNAP/Clavardage en direct/Aide <br>https://igmfinancial.service-now.com/snap&nbsp;<br><br>Ce courriel a &eacute;t&eacute; produit par le syst&egrave;me. Veuillez ne pas y r&eacute;pondre.</p>",
                        "context": {
                            "firstName.$": "$.getIdentity.attributes.firstname",
                            "lastName.$": "$.getIdentity.attributes.lastname",
                            "sAMAccountName.$": "$.getIdentity.attributes.samaccountname"
                        },
                        "recipientEmailList": [
                            "fieldnetworkadministration@ig.ca"
                        ],
                        "subject": "Offboarding Complete for ${firstName} ${lastName} / Retrait d’utilisateur effectué pour ${firstName} ${lastName}"
                    },
                    "description": "Email for Advisors goes to Field Network Administration",
                    "nextStep": "success",
                    "type": "action",
                    "versionNumber": 2
                },
                "success": {
                    "description": null,
                    "type": "success"
                }
            }
        },
        "enabled": false,
        "creator": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "owner": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "trigger": {
            "type": "EVENT",
            "attributes": {
                "description": "Lifecycle State is terminated",
                "filter.$": "$.changes[?(@.attribute == \"cloudLifecycleState\")]",
                "id": "idn:identity-attributes-changed"
            }
        }
    }
}