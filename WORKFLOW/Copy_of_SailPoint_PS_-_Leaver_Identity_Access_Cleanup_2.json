{
    "version": 1,
    "var_self": {
        "type": "WORKFLOW",
        "id": "3d2bc40c-4976-42ba-b596-7c878eb468f6",
        "name": "Copy of SailPoint PS - Leaver Identity Access Cleanup 2"
    },
    "object": {
        "id": "3d2bc40c-4976-42ba-b596-7c878eb468f6",
        "name": "Copy of SailPoint PS - Leaver Identity Access Cleanup 2",
        "description": "Parent workflow for leaver scenario; calls a series of child workflows through HTTP requests; steps change ownership and membership in all objects to which the leaver is associated.",
        "created": "2025-07-22T13:23:33.515074657Z",
        "modified": "2025-08-20T09:57:32.920767798Z",
        "modifiedBy": {
            "type": "IDENTITY",
            "id": "8b3c97da521442999ef05af532ecf6f7",
            "name": "rahul.majumder"
        },
        "definition": {
            "start": "Wait",
            "steps": {
                "End Step — Success": {
                    "actionId": "sp:operator-success",
                    "type": "success"
                },
                "Get Identity": {
                    "actionId": "sp:get-identity",
                    "attributes": {
                        "id.$": "$.trigger.identity.id"
                    },
                    "description": "get id for user/leaver",
                    "nextStep": "Get Identity 1",
                    "type": "action",
                    "versionNumber": 2
                },
                "Get Identity 1": {
                    "actionId": "sp:get-identity",
                    "attributes": {
                        "id.$": "$.getIdentity.managerRef.id"
                    },
                    "description": "retrieve manager",
                    "nextStep": "Reassign Access Profile Ownership",
                    "type": "action",
                    "versionNumber": 2
                },
                "HTTP Request": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.attributes.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "4da6e00f-6e12-4547-badf-604d099a6fa5",
                        "oAuthClientSecret": "$.secrets.3f35f09d-9fa3-455f-b124-892163535129",
                        "oAuthCredentialLocation": "oAuthInBody",
                        "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-uat.api.identitynow.com/beta/workflows/execute/external/393862a0-c05a-4e1a-a7e9-999d3d2ec5f3"
                    },
                    "displayName": "Reassign Entitlement Ownership",
                    "nextStep": "HTTP Request 1",
                    "type": "action",
                    "versionNumber": 2
                },
                "HTTP Request 1": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.attributes.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "337c58f0-9a0b-45d2-b763-fb151072660d",
                        "oAuthClientSecret": "$.secrets.33e436e4-c9c7-47bd-b364-a274d2f50a91",
                        "oAuthCredentialLocation": "oAuthInBody",
                        "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-uat.api.identitynow.com/beta/workflows/execute/external/34d0bcd1-2b22-4141-b296-f4dbaa35f5ff"
                    },
                    "displayName": "Reassign Role Ownership",
                    "nextStep": "HTTP Request 2",
                    "type": "action",
                    "versionNumber": 2
                },
                "HTTP Request 2": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.attributes.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "4509badc-3471-4b31-8fbb-468810d1e1a2",
                        "oAuthClientSecret": "$.secrets.9849f58f-d504-4f25-b363-af5824f9b4c9",
                        "oAuthCredentialLocation": "oAuthInBody",
                        "oAuthScope": null,
                        "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-uat.api.identitynow.com/beta/workflows/execute/external/d0edb0a5-0b43-4e9e-b1ea-3b02c275a884"
                    },
                    "displayName": "Reassign Governance Group Ownership",
                    "nextStep": "End Step — Success",
                    "type": "action",
                    "versionNumber": 2
                },
                "Reassign Access Profile Ownership": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.attributes.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "063bc0f2-c5f1-4423-a97b-c8c4b680f03a",
                        "oAuthClientSecret": "$.secrets.9a5cf61b-6e26-4a2f-864f-068b3821ce03",
                        "oAuthCredentialLocation": "oAuthInBody",
                        "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-uat.api.identitynow.com/beta/workflows/execute/external/12ec2d53-36d0-4ccf-b1db-c30e61dc29f8"
                    },
                    "description": "call request to reassign access profile ownership",
                    "nextStep": "HTTP Request",
                    "type": "action",
                    "versionNumber": 2
                },
                "Wait": {
                    "actionId": "sp:sleep",
                    "attributes": {
                        "duration": "1m",
                        "type": "waitFor"
                    },
                    "description": "Adding wait for birthright roles to de-provision",
                    "nextStep": "Get Identity",
                    "type": "action",
                    "versionNumber": 1
                }
            }
        },
        "enabled": false,
        "creator": {
            "type": "IDENTITY",
            "id": "8b3c97da521442999ef05af532ecf6f7",
            "name": "rahul.majumder"
        },
        "owner": {
            "type": "IDENTITY",
            "id": "8b3c97da521442999ef05af532ecf6f7",
            "name": "rahul.majumder"
        },
        "trigger": {
            "type": "EVENT",
            "attributes": {
                "filter.$": "$.changes[?(@.attribute=='cloudLifecycleState' && (@.newValue=='terminated' || @.newValue=='suspended'))]",
                "id": "idn:identity-attributes-changed"
            }
        }
    }
}