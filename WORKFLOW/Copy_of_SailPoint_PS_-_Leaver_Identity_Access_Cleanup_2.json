{
    "version": 1,
    "var_self": {
        "type": "WORKFLOW",
        "id": "7b6309ca-8d1d-4370-8646-d621fde7dc18",
        "name": "Copy of SailPoint PS - Leaver Identity Access Cleanup 2"
    },
    "object": {
        "id": "7b6309ca-8d1d-4370-8646-d621fde7dc18",
        "name": "Copy of SailPoint PS - Leaver Identity Access Cleanup 2",
        "description": "Parent workflow for leaver scenario; calls a series of child workflows through HTTP requests; steps change ownership and membership in all objects to which the leaver is associated.",
        "created": "2025-08-01T09:59:06.210755467Z",
        "modified": "2025-09-03T15:11:19.573751825Z",
        "modifiedBy": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "definition": {
            "start": "Wait",
            "steps": {
                "End Step — Success": {
                    "actionId": "sp:operator-success",
                    "type": "success"
                },
                "Get Identity": {
                    "actionId": "sp:get-identity",
                    "attributes": {
                        "id.$": "$.trigger.identity.id"
                    },
                    "description": "get id for user/leaver",
                    "nextStep": "Get Identity 1",
                    "type": "action",
                    "versionNumber": 2
                },
                "Get Identity 1": {
                    "actionId": "sp:get-identity",
                    "attributes": {
                        "id.$": "$.getIdentity.managerRef.id"
                    },
                    "description": "retrieve manager",
                    "nextStep": "Reassign Access Profile Ownership",
                    "type": "action",
                    "versionNumber": 2
                },
                "HTTP Request": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.attributes.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "cdf39bc4-31c6-4b24-9c9e-64502fe92c10",
                        "oAuthClientSecret": "$.secrets.b5931749-eecc-4b9a-b1e8-e4546d16f806",
                        "oAuthCredentialLocation": "oAuthInBody",
                        "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-dev.api.identitynow.com/beta/workflows/execute/external/5409e059-a191-43c6-8b0d-4a35b3256192"
                    },
                    "displayName": "Reassign Entitlement Ownership",
                    "nextStep": "HTTP Request 1",
                    "type": "action",
                    "versionNumber": 2
                },
                "HTTP Request 1": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.attributes.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "0ba40dae-a5a6-4c6f-b40d-b122ffb2dab1",
                        "oAuthClientSecret": "$.secrets.b4f5d037-ff7b-4758-8a40-7cae05f0148e",
                        "oAuthCredentialLocation": "oAuthInBody",
                        "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-dev.api.identitynow.com/beta/workflows/execute/external/907b52d6-401d-4918-bf6c-40e747899a6b"
                    },
                    "displayName": "Reassign Role Ownership",
                    "nextStep": "HTTP Request 2",
                    "type": "action",
                    "versionNumber": 2
                },
                "HTTP Request 2": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.attributes.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "9e339346-a0bd-4b87-b0e4-bcb37038200e",
                        "oAuthClientSecret": "$.secrets.47edcaeb-9b99-412e-82b3-8628b72e4ad8",
                        "oAuthCredentialLocation": "oAuthInBody",
                        "oAuthScope": null,
                        "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-dev.api.identitynow.com/beta/workflows/execute/external/0eacb9cb-2aa9-46cf-9fd4-e9a47105aa75"
                    },
                    "displayName": "Reassign Governance Group Ownership",
                    "nextStep": "End Step — Success",
                    "type": "action",
                    "versionNumber": 2
                },
                "Reassign Access Profile Ownership": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.attributes.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "73dcfb74-d8f0-45a8-b7dc-f5279762b296",
                        "oAuthClientSecret": "$.secrets.0c658907-b84e-4991-ac3c-fb8fcd88348c",
                        "oAuthCredentialLocation": "oAuthInBody",
                        "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-dev.api.identitynow.com/beta/workflows/execute/external/06710a4a-0efb-4d90-8d3d-759655524764"
                    },
                    "description": "call request to reassign access profile ownership",
                    "nextStep": "HTTP Request",
                    "type": "action",
                    "versionNumber": 2
                },
                "Wait": {
                    "actionId": "sp:sleep",
                    "attributes": {
                        "duration": "1m",
                        "type": "waitFor"
                    },
                    "description": "Adding wait for birthright roles to de-provision",
                    "nextStep": "Get Identity",
                    "type": "action",
                    "versionNumber": 1
                }
            }
        },
        "enabled": true,
        "creator": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "owner": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "trigger": {
            "type": "EVENT",
            "attributes": {
                "filter.$": "$.changes[?(@.attribute=='cloudLifecycleState' && (@.newValue=='terminated' || @.newValue=='suspended'))]",
                "id": "idn:identity-attributes-changed"
            }
        }
    }
}