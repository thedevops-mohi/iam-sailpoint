{
    "version": 1,
    "var_self": {
        "type": "WORKFLOW",
        "id": "1826e9df-0103-41d5-8cbb-caa7e3debdce",
        "name": "SailPoint PS - Leaver Identity Access Cleanup"
    },
    "object": {
        "id": "1826e9df-0103-41d5-8cbb-caa7e3debdce",
        "name": "SailPoint PS - Leaver Identity Access Cleanup",
        "description": "Parent workflow for leaver scenario; calls a series of child workflows through HTTP requests; steps change ownership and membership in all objects to which the leaver is associated.",
        "created": "2025-08-21T14:23:51.314949201Z",
        "modified": "2025-08-21T16:03:38.393607043Z",
        "modifiedBy": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "definition": {
            "start": "Wait",
            "steps": {
                "End Step — Success": {
                    "actionId": "sp:operator-success",
                    "type": "success"
                },
                "Get Identity": {
                    "actionId": "sp:get-identity",
                    "attributes": {
                        "id.$": "$.trigger.identity.id"
                    },
                    "description": "get id for user/leaver",
                    "nextStep": "Get Identity 1",
                    "type": "action",
                    "versionNumber": 2
                },
                "Get Identity 1": {
                    "actionId": "sp:get-identity",
                    "attributes": {
                        "id.$": "$.getIdentity.managerRef.id"
                    },
                    "description": "retrieve manager",
                    "nextStep": "Reassign Entitlement Ownership",
                    "type": "action",
                    "versionNumber": 2
                },
                "Reassign Access Profile Ownership": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.attributes.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "cd7163c1-14b7-451c-9049-d99b00430ed2",
                        "oAuthClientSecret": "$.secrets.f79338e6-a2a9-4a64-958e-474824ce96e2",
                        "oAuthCredentialLocation": "oAuthInBody",
                        "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-dev.api.identitynow.com/beta/workflows/execute/external/e13f1dfc-d123-4779-aa89-ddbac6e19758"
                    },
                    "description": "call request to reassign access profile ownership",
                    "nextStep": "Reassign Role Ownership",
                    "type": "action",
                    "versionNumber": 2
                },
                "Reassign Entitlement Ownership": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "cc2ae251-46ea-47e3-a95a-bf3c6deb6a2a",
                        "oAuthClientSecret": "$.secrets.7af50f9c-a7c5-4694-8c17-79bd7b1d31db",
                        "oAuthCredentialLocation": "oAuthInBody",
                        "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-dev.api.identitynow.com/beta/workflows/execute/external/dc8f5c1c-ec0e-4f6c-9bd2-cee5be4456a0"
                    },
                    "description": "call request to reassign entitlement ownership",
                    "nextStep": "Reassign Access Profile Ownership",
                    "type": "action",
                    "versionNumber": 2
                },
                "Reassign Governance Group Membership": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.attributes.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "6e0b9647-e2b8-4235-8328-9a82afc65abf",
                        "oAuthClientSecret": "$.secrets.29d1270f-1f0a-453b-a302-97a43479a97d",
                        "oAuthCredentialLocation": "oAuthInHeader",
                        "oAuthScope": null,
                        "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "url": "https://igmfinancial-dev.api.identitynow.com/beta/workflows/execute/external/09d2ef9b-7f4b-42ed-bfa4-9a2211a8ce30"
                    },
                    "nextStep": "Reassign Governance Group Ownership",
                    "type": "action",
                    "versionNumber": 2
                },
                "Reassign Governance Group Ownership": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.attributes.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "4e053bcd-5b3f-4b4d-b5ca-b5a142327f84",
                        "oAuthClientSecret": "$.secrets.ee3d2677-82f7-4b9c-bfe6-f620c7bd895e",
                        "oAuthCredentialLocation": "oAuthInHeader",
                        "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "url": "https://igmfinancial-dev.api.identitynow.com/beta/workflows/execute/external/c48e2cc0-1f06-4622-af34-d8796649139c"
                    },
                    "nextStep": "End Step — Success",
                    "type": "action",
                    "versionNumber": 2
                },
                "Reassign Role Ownership": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.attributes.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "bc17d3dd-37a1-4ffa-a8d6-c6e4cf5a7305",
                        "oAuthClientSecret": "$.secrets.b5ca1cee-e06d-4f65-aad5-36e3e78b34d6",
                        "oAuthCredentialLocation": "oAuthInBody",
                        "oAuthTokenUrl": "https://igmfinancial-dev.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-dev.api.identitynow.com/beta/workflows/execute/external/572ca4e8-7c24-443f-b349-3a798743fde2"
                    },
                    "description": "call request to reassign role ownership",
                    "nextStep": "Reassign Governance Group Membership",
                    "type": "action",
                    "versionNumber": 2
                },
                "Wait": {
                    "actionId": "sp:sleep",
                    "attributes": {
                        "duration": "1m",
                        "type": "waitFor"
                    },
                    "description": "Adding wait for birthright roles to de-provision",
                    "nextStep": "Get Identity",
                    "type": "action",
                    "versionNumber": 1
                }
            }
        },
        "enabled": false,
        "creator": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "owner": {
            "type": "IDENTITY",
            "id": "8854446c0c0c4b5bb87ca482a91b0ef3",
            "name": "Rahul.Majumder"
        },
        "trigger": {
            "type": "EVENT",
            "attributes": {
                "filter.$": "$.changes[?(@.attribute=='cloudLifecycleState' && @.newValue=='terminated')]",
                "id": "idn:identity-attributes-changed"
            }
        }
    }
}