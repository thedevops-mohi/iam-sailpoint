{
    "version": 1,
    "var_self": {
        "type": "WORKFLOW",
        "id": "748bfa07-4302-42c5-8d37-5371cf70060b",
        "name": "SailPoint PS - Leaver Identity Access Cleanup"
    },
    "object": {
        "id": "748bfa07-4302-42c5-8d37-5371cf70060b",
        "name": "SailPoint PS - Leaver Identity Access Cleanup",
        "description": "Parent workflow for leaver scenario; calls a series of child workflows through HTTP requests; steps change ownership and membership in all objects to which the leaver is associated.",
        "created": "2025-04-07T22:53:28.878270057Z",
        "modified": "2025-07-25T14:49:19.680830159Z",
        "modifiedBy": {
            "type": "IDENTITY",
            "id": "8b3c97da521442999ef05af532ecf6f7",
            "name": "rahul.majumder"
        },
        "definition": {
            "start": "Wait",
            "steps": {
                "End Step — Success": {
                    "actionId": "sp:operator-success",
                    "type": "success"
                },
                "Get Identity": {
                    "actionId": "sp:get-identity",
                    "attributes": {
                        "id.$": "$.trigger.identity.id"
                    },
                    "description": "get id for user/leaver",
                    "nextStep": "Get Identity 1",
                    "type": "action",
                    "versionNumber": 2
                },
                "Get Identity 1": {
                    "actionId": "sp:get-identity",
                    "attributes": {
                        "id.$": "$.getIdentity.managerRef.id"
                    },
                    "description": "retrieve manager",
                    "nextStep": "Reassign Entitlement Ownership",
                    "type": "action",
                    "versionNumber": 2
                },
                "Reassign Access Profile Ownership": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.attributes.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "8efb0db1-e6d1-4519-a36f-160b2284b5f7",
                        "oAuthClientSecret": "$.secrets.d2d7e112-6fa2-4b08-8ab8-80c115e5f77f",
                        "oAuthCredentialLocation": "oAuthInBody",
                        "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-uat.api.identitynow.com/beta/workflows/execute/external/141b761b-fac6-44d2-a16e-048863148aa1"
                    },
                    "description": "call request to reassign access profile ownership",
                    "nextStep": "Reassign Role Ownership",
                    "type": "action",
                    "versionNumber": 2
                },
                "Reassign Entitlement Ownership": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "0cba8d61-0c99-40f4-ae74-dbd807d16db1",
                        "oAuthClientSecret": "$.secrets.af2356f3-a9af-47e3-8fd6-571e56f01bb3",
                        "oAuthCredentialLocation": "oAuthInBody",
                        "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-uat.api.identitynow.com/beta/workflows/execute/external/d111715e-2db9-4268-8a50-3f15847c4ed4"
                    },
                    "description": "call request to reassign entitlement ownership",
                    "nextStep": "Reassign Access Profile Ownership",
                    "type": "action",
                    "versionNumber": 2
                },
                "Reassign Governance Group Membership": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.attributes.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "a4e1bbe0-d93c-47c6-84f0-007e30445c62",
                        "oAuthClientSecret": "$.secrets.ea8e4acb-5981-4a8e-89b4-e6dad331ee3b",
                        "oAuthCredentialLocation": "oAuthInHeader",
                        "oAuthScope": null,
                        "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "url": "https://igmfinancial-uat.api.identitynow.com/beta/workflows/execute/external/a5c451a2-9716-47dc-a372-fafedac2c5e9"
                    },
                    "nextStep": "Reassign Governance Group Ownership",
                    "type": "action",
                    "versionNumber": 2
                },
                "Reassign Governance Group Ownership": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.attributes.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "f44c272e-9942-4873-bbb0-b7700747e4ed",
                        "oAuthClientSecret": "$.secrets.84ffb22e-95c3-4608-ba9b-304ef1567f60",
                        "oAuthCredentialLocation": "oAuthInHeader",
                        "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "url": "https://igmfinancial-uat.api.identitynow.com/beta/workflows/execute/external/14601058-2305-48c6-b104-8a07bcad37de"
                    },
                    "nextStep": "End Step — Success",
                    "type": "action",
                    "versionNumber": 2
                },
                "Reassign Role Ownership": {
                    "actionId": "sp:http",
                    "attributes": {
                        "authenticationType": "OAuth",
                        "jsonRequestBody": {
                            "leaverId": {
                                "id": "{{$.getIdentity.id}}",
                                "name": "{{$.getIdentity.attributes.firstname}} {{$.getIdentity.attributes.lastname}}"
                            },
                            "managerRef": {
                                "email": "{{$.getIdentity1.attributes.email}}",
                                "id": "{{$.getIdentity1.id}}",
                                "name": "{{$.getIdentity1.attributes.firstname}}"
                            }
                        },
                        "method": "post",
                        "oAuthClientId": "7194bae8-581a-4e07-a2cc-1543741f3bd4",
                        "oAuthClientSecret": "$.secrets.88e1527c-fc43-4ed0-b9d0-603a6deff607",
                        "oAuthCredentialLocation": "oAuthInBody",
                        "oAuthTokenUrl": "https://igmfinancial-uat.api.identitynow.com/oauth/token",
                        "requestContentType": "json",
                        "requestHeaders": {
                            "Content-Type": "application/json"
                        },
                        "url": "https://igmfinancial-uat.api.identitynow.com/beta/workflows/execute/external/197b43da-4d8d-4b15-b5ee-edc7f22cac37"
                    },
                    "description": "call request to reassign role ownership",
                    "nextStep": "Reassign Governance Group Membership",
                    "type": "action",
                    "versionNumber": 2
                },
                "Wait": {
                    "actionId": "sp:sleep",
                    "attributes": {
                        "duration": "1m",
                        "type": "waitFor"
                    },
                    "description": "Adding wait for birthright roles to de-provision",
                    "nextStep": "Get Identity",
                    "type": "action",
                    "versionNumber": 1
                }
            }
        },
        "enabled": false,
        "creator": {
            "type": "IDENTITY",
            "id": "628f08e9d3754deb94463c6380d0f61d",
            "name": "slpt.services"
        },
        "owner": {
            "type": "IDENTITY",
            "id": "628f08e9d3754deb94463c6380d0f61d",
            "name": "slpt.services"
        },
        "trigger": {
            "type": "EVENT",
            "attributes": {
                "filter.$": "$.changes[?(@.attribute=='cloudLifecycleState' && @.newValue=='terminated')]",
                "id": "idn:identity-attributes-changed"
            }
        }
    }
}